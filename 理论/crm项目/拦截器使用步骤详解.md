# 拦截器使用步骤详解



### 1. 创建拦截器类：

```
第一种方式：继承 HandlerInterceptorAdapter 

第二种方式：实现 HandlerInterceptor 接口 (推荐使用)
```



#### HandlerInterceptor 接口分析

```java
public interface HandlerInterceptor {

	default boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)
			throws Exception {

		return true;
	}

	default void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler,
			@Nullable ModelAndView modelAndView) throws Exception {
	}


	default void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler,
			@Nullable Exception ex) throws Exception {
	}

}
```



接口中含有三个方法：  

(1) preHandle

```
该方法在handler方法执行之前执行，其返回值为 boolean。 
若为 true， 则紧接着会执行handler方法， 且会将 afterCompletion()方法放入到一个专门的方法栈中等待执行。 
若为 false，则后续的拦截器以及handler方法等都不会再执行。当前返回false的拦截器之前的拦截器的afterCompletion方法会执行。
```

(2) postHandle

```
该方法在handler方法执行之后执行，即handler方法return之后，去执行postHandle方法。如果handler方法最终未被执行，则该方法不会执行。由于该方法是在handler方法执行完后执行，且该方法参数中包含 ModelAndView，所以该方法可以获得handler方法return的ModelAndView对象，可以对这个ModelAndView对象进行修改。也可以修改跳转方向。  
```

(3)afterCompletion

```
当 preHandle()方法返回true时，会将该方法放到专门的方法栈中，等到对请求进行响应的所有工作完成之后才执行该方法。 即该方法是在中央调度器渲染（数据填充） 了响应页面之后执行的， 此时对 ModelAndView 再操作也对响应无济于事。 afterCompletion 最后执
行的方法， 清除资源， 例如在 Controller 方法中加入数据等。  
```



### 2. 配置 springmvc.xml 文件

```
<!--注册拦截器-->
<mvc:interceptors>
  <mvc:interceptor>
    <!--配置拦截的路径(哪些请求被拦截)-->
    <mvc:mapping path="/**"/>
    <!--设置放行的请求-->
    <mvc:exclude-mapping path="/login"></mvc:exclude-mapping>
    <mvc:exclude-mapping path="/showLogin"></mvc:exclude-mapping>

    <!--设置进行功能处理的拦截器类-->
    <bean class="com.bjpowernode.interceptor.LoginInterceptor"></bean>
  </mvc:interceptor>
</mvc:interceptors>
```

